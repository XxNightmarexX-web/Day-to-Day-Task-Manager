<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Task Manager</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
body { font-family:'Segoe UI',sans-serif; margin:0; padding:0; background:#f0f2f5; color:#000; transition:0.3s; }
body.dark { background:#181818; color:#fff; }
h1{text-align:center;margin:20px 0;}
#notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#ff9800;color:#000;padding:12px 20px;border-radius:8px;display:none;z-index:100;box-shadow:0 2px 6px rgba(0,0,0,0.3);font-weight:bold;}
canvas#confetti{position:fixed;top:0;left:0;pointer-events:none;z-index:999;}
#taskForm{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px;width:95%;max-width:800px;}
#taskForm input,#taskForm select,#taskForm button{padding:10px;border-radius:5px;border:1px solid #ccc;font-size:1em;}
#taskForm button{background:#4caf50;color:white;border:none;cursor:pointer;transition:0.3s;}
#taskForm button:hover{background:#388e3c;}
#taskList{list-style:none;padding:0;width:95%;max-width:800px;}
.taskItem{background:#fff;padding:12px;margin-bottom:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;box-shadow:0 2px 5px rgba(0,0,0,0.2);transition: transform 0.1s;}
body.dark .taskItem{background:#282c34;box-shadow:0 2px 6px rgba(0,0,0,0.5);}
.taskItem.completed{text-decoration:line-through;opacity:0.6;}
.taskItem:hover{transform:scale(1.02);}
.taskItem span{flex:1 1 60%;}
.taskItem small{font-size:0.8em;margin-left:5px;}
.taskItem .category{font-weight:bold;margin-right:5px;}
.low{color:#4caf50;font-weight:bold;}
.medium{color:#ff9800;font-weight:bold;}
.high{color:#f44336;font-weight:bold;}
.taskItem button{margin-left:5px;padding:5px 10px;border:none;border-radius:5px;cursor:pointer;transition:0.2s;}
.completeBtn{background:#4caf50;color:white;} .completeBtn:hover{background:#388e3c;}
.deleteBtn{background:#e74c3c;color:white;} .deleteBtn:hover{background:#c0392b;}
.filters{margin-bottom:15px;text-align:center;}
.filters button{margin:5px;padding:8px 12px;border-radius:5px;border:none;background:#2196f3;color:white;cursor:pointer;transition:0.3s;}
.filters button:hover{background:#1976d2;}
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;max-width:800px;margin:20px auto;}
.dayCell{background:#e0e0e0;padding:10px;text-align:center;border-radius:5px;cursor:pointer;}
body.dark .dayCell{background:#333;}
.dayCell:hover{background:#b3e5fc;}
.dayCell.today{border:2px solid #4caf50;}
#dashboard{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;max-width:800px;margin-bottom:30px;}
.chartContainer{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
body.dark .chartContainer{background:#282c34;}
@media(max-width:600px){#taskForm input,#taskForm select,#taskForm button{flex:1 1 100%;}.taskItem span{flex:1 1 100%;margin-bottom:5px;}#dashboard{flex-direction:column;align-items:center;}}
</style>
</head>
<body>

<h1>Ultimate Task Manager</h1>
<div id="notification"></div>
<canvas id="confetti"></canvas>
<button id="themeToggle">Toggle Dark/Light Theme</button>

<div id="progressContainer" style="width:95%; max-width:800px; background:#ccc; border-radius:8px; overflow:hidden; margin:20px auto;">
  <div id="progressBar" style="height:20px;width:0%;background:#4caf50;transition:width 0.3s;"></div>
</div>

<div id="taskForm">
  <input type="text" id="taskInput" placeholder="Task description">
  <input type="date" id="taskDate">
  <input type="time" id="taskTime">
  <select id="taskPriority">
    <option value="Low">Low Priority</option>
    <option value="Medium" selected>Medium Priority</option>
    <option value="High">High Priority</option>
  </select>
  <select id="taskCategory">
    <option value="General" selected>General</option>
    <option value="Work">Work</option>
    <option value="Personal">Personal</option>
    <option value="Study">Study</option>
  </select>
  <select id="taskRecurring">
    <option value="None" selected>Not Recurring</option>
    <option value="Daily">Daily</option>
    <option value="Weekly">Weekly</option>
    <option value="Monthly">Monthly</option>
    <option value="Yearly">Yearly</option>
  </select>
  <button id="addBtn">Add Task</button>
  <button id="exportBtn">Export</button>
  <button id="importBtn">Import</button>
  <input type="file" id="importFile" style="display:none;">
</div>

<div class="filters">
  <button onclick="filterTasks('all')">All</button>
  <button onclick="filterTasks('pending')">Pending</button>
  <button onclick="filterTasks('completed')">Completed</button>
  <button onclick="filterTasks('high')">High</button>
  <button onclick="filterTasks('medium')">Medium</button>
  <button onclick="filterTasks('low')">Low</button>
</div>

<div id="calendar"></div>

<div id="dashboard">
  <div class="chartContainer"><canvas id="priorityChart" width="300" height="200"></canvas></div>
  <div class="chartContainer"><canvas id="categoryChart" width="300" height="200"></canvas></div>
</div>

<ul id="taskList"></ul>

<script>
let tasks=JSON.parse(localStorage.getItem('tasks'))||[];
let filter='all', darkTheme=false;

const taskList=document.getElementById('taskList');
const taskInput=document.getElementById('taskInput');
const taskDate=document.getElementById('taskDate');
const taskTime=document.getElementById('taskTime');
const taskPriority=document.getElementById('taskPriority');
const taskRecurring=document.getElementById('taskRecurring');
const taskCategory=document.getElementById('taskCategory');
const addBtn=document.getElementById('addBtn');
const notification=document.getElementById('notification');
const progressBar=document.getElementById('progressBar');
const themeToggle=document.getElementById('themeToggle');
const exportBtn=document.getElementById('exportBtn');
const importBtn=document.getElementById('importBtn');
const importFile=document.getElementById('importFile');
const confettiCanvas=document.getElementById('confetti');
const ctx=confettiCanvas.getContext('2d');
confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight;

function showNotification(msg){ notification.textContent=msg; notification.style.display='block'; setTimeout(()=>notification.style.display='none',3000); }
function saveTasks(){ localStorage.setItem('tasks',JSON.stringify(tasks)); updateProgress(); renderCharts(); }

function updateProgress(){
  if(tasks.length===0){ progressBar.style.width='0%'; return; }
  const completed=tasks.filter(t=>t.completed).length;
  const percent=(completed/tasks.length)*100;
  progressBar.style.width=percent+'%';
  if(percent===100 && tasks.length>0) triggerConfetti();
}

function renderTasks(){
  taskList.innerHTML='';
  tasks.forEach((task,index)=>{
    if(filter==='pending' && task.completed) return;
    if(filter==='completed' && !task.completed) return;
    if(filter==='high' && task.priority!=='High') return;
    if(filter==='medium' && task.priority!=='Medium') return;
    if(filter==='low' && task.priority!=='Low') return;
    const li=document.createElement('li');
    li.className='taskItem'+(task.completed?' completed':'');
    li.innerHTML=`
      <span><span class="category">${task.category}</span> ${task.text} 
      <small>${task.date?task.date:''} ${task.time?task.time:''} 
      <span class="${task.priority.toLowerCase()}">[${task.priority}]</span>
      ${task.recurring!=='None'?'['+task.recurring+']':''}</small></span>
      <div>
        <button class="completeBtn" onclick="toggleComplete(${index})">${task.completed?'Undo':'Done'}</button>
        <button class="deleteBtn" onclick="deleteTask(${index})">Delete</button>
      </div>
    `;
    taskList.appendChild(li);
  });
}

function toggleComplete(index){
  tasks[index].completed=!tasks[index].completed;
  // Handle recurring tasks
  if(tasks[index].completed && tasks[index].recurring!=='None'){
    const nextDate=new Date(tasks[index].date);
    if(tasks[index].recurring==='Daily') nextDate.setDate(nextDate.getDate()+1);
    if(tasks[index].recurring==='Weekly') nextDate.setDate(nextDate.getDate()+7);
    if(tasks[index].recurring==='Monthly') nextDate.setMonth(nextDate.getMonth()+1);
    if(tasks[index].recurring==='Yearly') nextDate.setFullYear(nextDate.getFullYear()+1);
    tasks[index].date=nextDate.toISOString().split('T')[0];
    tasks[index].completed=false;
  }
  saveTasks(); renderTasks();
}

function deleteTask(index){ tasks.splice(index,1); saveTasks(); renderTasks(); }

addBtn.addEventListener('click',()=>{
  if(taskInput.value.trim()===''){ showNotification('Task cannot be empty!'); return; }
  const newTask={
    text:taskInput.value.trim(),
    date:taskDate.value,
    time:taskTime.value,
    priority:taskPriority.value,
    category:taskCategory.value,
    recurring:taskRecurring.value,
    completed:false
  };
  tasks.push(newTask); saveTasks(); renderTasks();
  taskInput.value=''; taskDate.value=''; taskTime.value='';
  showNotification('Task added!');
});

function filterTasks(type){ filter=type; renderTasks(); }

themeToggle.addEventListener('click',()=>{
  darkTheme=!darkTheme;
  document.body.classList.toggle('dark',darkTheme);
});

exportBtn.addEventListener('click',()=>{
  const dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(tasks));
  const dlAnchor=document.createElement('a');
  dlAnchor.setAttribute('href',dataStr);
  dlAnchor.setAttribute('download','tasks.json');
  dlAnchor.click();
});

importBtn.addEventListener('click',()=>{ importFile.click(); });
importFile.addEventListener('change',e=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=function(){ tasks=JSON.parse(reader.result); saveTasks(); renderTasks(); }
  reader.readAsText(file);
});

function renderCharts(){
  const priorityData={High:0,Medium:0,Low:0};
  const categoryData={};
  tasks.forEach(t=>{ priorityData[t.priority]++; categoryData[t.category]=(categoryData[t.category]||0)+1; });
  if(window.priorityChartInstance) window.priorityChartInstance.destroy();
  if(window.categoryChartInstance) window.categoryChartInstance.destroy();
  window.priorityChartInstance=new Chart(document.getElementById('priorityChart'),{
    type:'doughnut',
    data:{labels:Object.keys(priorityData),datasets:[{data:Object.values(priorityData),backgroundColor:['#f44336','#ff9800','#4caf50']}]},
  });
  window.categoryChartInstance=new Chart(document.getElementById('categoryChart'),{
    type:'doughnut',
    data:{labels:Object.keys(categoryData),datasets:[{data:Object.values(categoryData),backgroundColor:['#2196f3','#9c27b0','#ff9800','#4caf50','#00bcd4']}]},
  });
}

// Simple confetti
function triggerConfetti(){
  const confetti=[];
  for(let i=0;i<150;i++) confetti.push({x:Math.random()*confettiCanvas.width, y:Math.random()*confettiCanvas.height, r:Math.random()*6+4, d:Math.random()*15});
  let t=0;
  function draw(){
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    confetti.forEach(c=>{ ctx.fillStyle='rgba(255,165,0,0.9)'; ctx.beginPath(); ctx.arc(c.x, c.y, c.r,0,2*Math.PI); ctx.fill(); c.y+=Math.cos(t+c.d)+1+ c.r/2; c.x+=Math.sin(t); if(c.y>confettiCanvas.height) c.y=-10; });
    t+=0.05; requestAnimationFrame(draw);
  }
  draw(); setTimeout(()=>ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height),3000);
}

// Simple Calendar
const calendar=document.getElementById('calendar');
function renderCalendar(){
  calendar.innerHTML='';
  const now=new Date();
  const year=now.getFullYear();
  const month=now.getMonth();
  const firstDay=new Date(year,month,1).getDay();
  const daysInMonth=new Date(year,month+1,0).getDate();
  for(let i=0;i<firstDay;i++){ const emptyDiv=document.createElement('div'); calendar.appendChild(emptyDiv); }
  for(let d=1;d<=daysInMonth;d++){
    const dayDiv=document.createElement('div');
    dayDiv.className='dayCell'+(d===now.getDate()?' today':'');
    dayDiv.textContent=d;
    dayDiv.addEventListener('click',()=>{ filterByDate(`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`); });
    calendar.appendChild(dayDiv);
  }
}
function filterByDate(dateStr){ tasks.forEach((t,i)=>{ t.completed=false; }); filterTasks('all'); renderTasks(); showNotification('Filtered by date: '+dateStr); }

window.addEventListener('resize',()=>{ confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight; });

Sortable.create(taskList,{animation:150,onEnd:()=>{ const newTasks=[]; taskList.querySelectorAll('.taskItem').forEach(item=>{ const index=Array.from(taskList.children).indexOf(item); newTasks.push(tasks[index]); }); tasks=newTasks; saveTasks(); }});

renderTasks(); renderCharts(); renderCalendar(); updateProgress();
</script>
</body>
</html>
